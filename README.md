# Занятие №1. Реляционная алгебра

В дальнейшем в курсе мы будем работать с таблицами и учиться извлекать из них нужную информацию.
Таблица — это способ представить данные в структурированном виде: строки соответствуют объектам, а столбцы — их свойствам.

Рассмотрим, например, такую таблицу с некоторой информацией про студентов:

| StudentID | Name         | Age | Major         | GPA  |
|-----------|--------------|-----|---------------|------|
| 1         | Иванов И.И.  | 20  | Информатика   | 3.8  |
| 2         | Петрова А.А. | 22  | Математика    | 3.5  |
| 3         | Сидоров П.П. | 21  | Физика        | 3.9  |

Каждая **строка** описывает некоторого студента.\
Каждый **столбец** обозначает некоторое свойство — ФИО, возраст, средний балл.\
В столбце со средним баллом ожидаем дробное число;\
В столбце Major ожидаем название специализации.

Для формализации правил работы с таблицами вводится **реляционная алгебра**.

## Основные понятия реляционной алгебры

Реляционная алгебра представляет собой теоретический язык для работы с отношениями в реляционных базах данных. Она основана на теории множеств и включает набор операций, позволяющих манипулировать данными. Ключевые понятия и операции реляционной алгебры включают следующие элементы:

### Основные термины

- **Сущность**: Объект предметной области, который моделируется в базе данных;
- **Кортеж**: Экземпляр сущности, (строка в таблице, содержащая значения атрибутов);
- **Атрибут**: Свойство сущности, отражающее характеристики (столбец);
- **Домен**: Множество допустимых значений для атрибута;
- **Отношение**: Таблица, состоящая из заголовка и тела;
- **Заголовок отношения**: Список атрибутов;
- **Тело отношения**: Множество кортежей, входящих в состав отношения;
 
Note: Тело отношения — подмножество декартова произведения доменов атрибутов заголовка отношения.


Опишите пример, используя новые термины:

| StudentID | Name         | Age | Major         | GPA  |
|-----------|--------------|-----|---------------|------|
| 1         | Иванов И.И.  | 20  | Информатика   | 3.8  |
| 2         | Петрова А.А. | 22  | Математика    | 3.5  |
| 3         | Сидоров П.П. | 21  | Физика        | 3.9  |
| 4         | Смирнова Е.Е.| 23  | Химия         | 3.6  |
| 5         | Кузнецов В.В.| 20  | Биология      | 3.7  |

Для *атрибута* **Major** *доменом* будет являться множество специальностей:\
*{Информатика, Математика, Физика, Химия, Биология}*.

### Характеристики отношений

1. **Степень отношения (арность отношения)**: Степень отношения определяется количеством атрибутов (столбцов) в нем. Например, если отношение имеет три атрибута, его степень равна 3.

2. **Мощность отношения (кардинальность отношения)**: количество кортежей в отношении.

### Свойства отношений

1. **Уникальность кортежей**

4. **Домен атрибутов**: Каждый атрибут в отношении связан с определенным доменом, который представляет собой множество допустимых значений для этого атрибута. Это обеспечивает семантическую однозначность данных.

5. **Замкнутость операций**: Все операции реляционной алгебры над отношениями возвращают новое отношение, что позволяет комбинировать результаты различных операций и строить сложные запросы.

Эти свойства формируют основу для работы с данными в реляционных базах и обеспечивают их целостность и структурированность.


### Операции реляционной алгебры

Реляционная алгебра включает восемь основных операций, предложенных Эдгаром Коддом:

1. **Объединение (Union)**: Возвращает отношение, содержащее все кортежи, которые принадлежат хотя бы одному из двух заданных отношений.
2. **Пересечение (Intersection)**: Возвращает отношение с кортежами, которые принадлежат обоим заданным отношениям.
3. **Разность (Set Difference)**: Возвращает отношение с кортежами, которые принадлежат первому отношению, но не принадлежат второму.
4. **Декартово произведение (Cartesian Product)**: Создает новое отношение, состоящее из всех возможных пар кортежей из двух заданных отношений.
5. **Выборка (Ограничение, Selection)**: Извлекает кортежи из отношения, удовлетворяющие определенному условию.
6. **Проекция (Projection)**: Извлекает определенные атрибуты из отношения, создавая новое отношение с выбранными атрибутами.
7. **Соединение (Join)**: Объединяет два отношения по общему атрибуту, создавая новое отношение с соответствующими кортежами.
8. **Деление (Division)**: Используется для получения кортежей из одного отношения, которые соответствуют всем значениям атрибутов другого отношения.

## Примеры операций реляционной алгебры

Рассмотрим примеры для каждой из основных операций реляционной алгебры, используя две таблицы: `Students` и `Courses`.

Обсудите, какое отношение будет являться результатом для каждой операции.

### Таблица: Students

| StudentID | Name         | Major        |
|-----------|--------------|--------------|
| 1         | Иванов И.И.  | Информатика  |
| 2         | Петрова А.А. | Математика   |
| 3         | Сидоров П.П. | Физика       |


### Таблица: MoreStudents

| StudentID | Name         | Major        |
|-----------|--------------|--------------|
| 3         | Сидоров П.П. | Физика       |
| 4         | Смирнова Е.Е.| Информатика  |


### Таблица: Courses

| CourseID | CourseName       | StudentID |
|----------|------------------|-----------|
| C1       | Алгоритмы        | 1         |
| C2       | Линейная алгебра | 2         |
| C3       | Физика           | 3         |
| C4       | Программирование | 1         |

### 1. Объединение (Union)

Объединение двух отношений с совпадающими заголовками.

Например, если у нас есть ещё одна таблица `MoreStudents`, содержащая студентов, мы можем объединить их:

$$
Students \cup MoreStudents
$$


<details> 
  <summary> Результат объединения </summary>

| StudentID | Name         | Major        |
|-----------|--------------|--------------|
| 1         | Иванов И.И.  | Информатика  |
| 2         | Петрова А.А. | Математика   |
| 3         | Сидоров П.П. | Физика       |
| 4         | Смирнова Е.Е.| Информатика  |

</details>

### 2. Пересечение (Intersection)

Возвращает кортежи, которые присутствуют в обоих отношениях с совпадающими заголовками. Например:
$$
Students \cap MoreStudents
$$

<details> 
  <summary> Результат пересечения </summary>

| StudentID | Name         | Major        |
|-----------|--------------|--------------|
| 3         | Сидоров П.П. | Физика       |

</details>

### 3. Разность (Set Difference)

Возвращает кортежи из первого отношения, которые отсутствуют во втором. У отношений должны совпадать заголовки.

$$
Students - MoreStudents
$$

<details> 
  <summary> Результат разности </summary>

| StudentID | Name         | Major        |
|-----------|--------------|--------------|
| 1         | Иванов И.И.  | Информатика  |
| 2         | Петрова А.А. | Математика   |

</details>

### 4. Декартово произведение (Cartesian Product)

Создает новое отношение, состоящее из всех возможных пар кортежей из двух отношений:

$$
Students \times Courses
$$

Сколько кортежей будет в таком отношении?

<details> 
  <summary>Ответ</summary>

| StudentID | Name         | Major        | CourseID | CourseName       | StudentID |
|-----------|--------------|--------------|----------|------------------|-----------|
| 1         | Иванов И.И.  | Информатика  | C1       | Алгоритмы        | 1         |
| 1         | Иванов И.И.  | Информатика  | C2       | Линейная алгебра | 2         |
| 1         | Иванов И.И.  | Информатика  | C3       | Физика           | 3         |
| 1         | Иванов И.И.  | Информатика  | C4       | Программирование | 1         |
| 2         | Петрова А.А. | Математика   | C1       | Алгоритмы        | 1         |
| 2         | Петрова А.А. | Математика   | C2       | Линейная алгебра | 2         |
| 2         | Петрова А.А. | Математика   | C3       | Физика           | 3         |
| 2         | Петрова А.А. | Математика   | C4       | Программирование | 1         |
| 3         | Сидоров П.П. | Физика       | C1       | Алгоритмы        | 1         |
| 3         | Сидоров П.П. | Физика       | C2       | Линейная алгебра | 2         |
| 3         | Сидоров П.П. | Физика       | C3       | Физика           | 3         |
| 3         | Сидоров П.П. | Физика       | C4       | Программирование | 1         |

</details>

### 5. Выборка/Ограничение (Selection)

Извлекает кортежи из отношения, удовлетворяющие заданному условию. Например, чтобы выбрать студентов, которые изучают "Информатику":

$$
\sigma_{Major='Информатика'}(Students)
$$

<details> 
  <summary>Ответ</summary>

| StudentID | Name         | Major        |
|-----------|--------------|--------------|
| 1         | Иванов И.И.  | Информатика  |

</details>

### 6. Проекция (Projection)

Извлекает определенные атрибуты из отношения. Например, чтобы получить только имена студентов:

$$
\pi_{Name}(Students)
$$

<details> 
  <summary>Ответ</summary>

| Name         |
|--------------|
| Иванов И.И.  |
| Петрова А.А. |
| Сидоров П.П. |
</details>

### 7. Соединение (Join)

Объединяет два отношения по общему атрибуту. Например, чтобы получить список студентов и названий их курсов:

$$
Students \bowtie Courses
$$

*Упражнение*: в данном примере выразить **Join** через декартово произведение, ограничение и проекцию.


<details>
  <summary>Ответ</summary>

$\sigma_{Students.StudentID=Courses.StudentID}(Students \times Courses)$

(После чего убираем проекцией повторяющийся атрибут StudentID)

| StudentID | Name         | Major        | CourseID | CourseName       |
|-----------|--------------|--------------|----------|------------------|
| 1         | Иванов И.И.  | Информатика  | C1       | Алгоритмы        |
| 2         | Петрова А.А. | Математика   | C2       | Линейная алгебра |
| 3         | Сидоров П.П. | Физика       | C3       | Физика           |
| 1         | Иванов И.И.  | Информатика  | C4       | Программирование |

</details>


### 8. Деление (Division)

Используется для получения кортежей из одного отношения, которые соответствуют всем значениям атрибутов другого отношения. Например, если мы хотим найти студентов, которые изучают все курсы:

$$
Students \div Courses
$$

Какой будет результат операции деления для отношений ниже?

**Students**
| Name         | Course        |
|--------------|--------------|
| Иванов И.И.  | Алгоритмы  |
| Иванов И.И. | Программирование   |
| Сидоров П.П. | Алгоритмы       |

**Courses**
| Course      |
|------------------|
| Алгоритмы        |
| Программирование |

<details> 
  <summary>Ответ</summary>

| Name         |
|--------------|
| Иванов И.И.  |

</details>

## Практические задания

Используется следующая схема базы данных:

- **STUDENT**($student\_id$, $student\_name$, $group\_id$, $year$)
- **COURSE**($course\_id$, $title$, $dept$)
- **CLASS**($class\_id$, $group\_id$, $course\_id$, $instructor$, $semester$)
- **ENROLL**($student\_id$, $class\_id$, $grade$)
- **PREREQ**($course\_id$, $prereq\_course\_id$)
- **CLUB**($club\_name$, $student\_id$)

---

## Задание 1  
**Найти имена студентов, обучающихся в группе `922`.**

<details> 
  <summary>Решение</summary>

1) Отбор студентов нужной группы:

$$
S_{922} = \sigma_{group\_id = "922"}(\text{STUDENT})
$$

2) Проекция имён:

$$
\pi_{student\_name}(S_{922})
$$

**Итог:**

$$
\pi_{student\_name}\bigl(\sigma_{group\_id = "922"}(\text{STUDENT})\bigr)
$$

</details>

---

## Задание 2  
**Получить пары $(student\_name, title)$ — какие студенты изучают какие курсы.  
Использовать только $\times$ и $\sigma$.**

<details> 
  <summary>Решение</summary>

1) Декартово произведение:

$$
R = \text{STUDENT} \times \text{ENROLL} \times \text{CLASS} \times \text{COURSE}
$$

2) Наложим условия соединения:

$$
R' = \sigma_{
\text{STUDENT}.student\_id = \text{ENROLL}.student\_id \;\wedge\;
\text{ENROLL}.class\_id = \text{CLASS}.class\_id \;\wedge\;
\text{CLASS}.course\_id = \text{COURSE}.course\_id
}(R)
$$

3) Проекция результата:

$$
\pi_{student\_name,\,title}(R')
$$

**Итог:**

$$
\pi_{student\_name,\,title}\Bigl(
\sigma_{
\text{STUDENT}.student\_id = \text{ENROLL}.student\_id \;\wedge\;
\text{ENROLL}.class\_id = \text{CLASS}.class\_id \;\wedge\;
\text{CLASS}.course\_id = \text{COURSE}.course\_id
}\bigl(
\text{STUDENT} \times \text{ENROLL} \times \text{CLASS} \times \text{COURSE}
\bigr)
\Bigr)
$$

</details>

---

## Задание 3  
**Найти студентов, посещающих все занятия курса `"Databases"`.**

<details> 
  <summary>Решение</summary>

1) Все занятия курса:

$$
T = \pi_{class\_id}\bigl(\sigma_{course\_id="DB101"}(\text{CLASS})\bigr)
$$

2) Факты посещения:

$$
R = \pi_{student\_id,\,class\_id}(\text{ENROLL})
$$

3) Деление:

$$
S = R \div T
$$

4) Получение имён:

$$
\pi_{student\_name}\bigl(\text{STUDENT} \bowtie S\bigr)
$$

**Итог:**

$$
\pi_{student\_name}\Bigl(
\text{STUDENT} \bowtie
\bigl(
\pi_{student\_id,\,class\_id}(\text{ENROLL})
\div
\pi_{class\_id}(\sigma_{course\_id="DB101"}(\text{CLASS}))
\bigr)
\Bigr)
$$

</details>

---

## Задание 4  
**Найти всех студентов второго курса.**

---

## Задание 5  
**Получить список всех различных групп, в которых учатся студенты.**

---

## Задание 6  
**Вывести названия всех курсов кафедры `"DM"`.**

---

## Задание 7  
**Найти студентов, которые обучаются в группе `"922"` и находятся на втором курсе.**

---

## Задание 8  
**Найти имена студентов и названия курсов, которые они изучают в семестре `"WS2026"`.**

---

## Задание 9  
**Вывести пары $(student\_name, instructor)$ - какие студенты учатся у каких преподавателей**

---

## Задание 10  
**Найти студентов, обучающихся у преподавателя `"Ivanov"`.**

---

## Задание 11  
**Получить список курсов, которые изучает группа `"922"`.**

---

## Задание 12  
**Найти студентов и их оценки по курсу `"Databases"`.**

---

## Задание 13  
**Найти студентов, которые состоят хотя бы в одном клубе.**

---

## Задание 14  
**Найти студентов, которые состоят в клубах и одновременно обучаются в группе `"026"`.**

---

## Задание 15  
**Найти студентов группы `"026"`, которые не состоят ни в одном клубе.**

---

## Задание 16  
**Найти студентов, не записанных ни на одно занятие.**

---

## Задание 17  
**Найти курсы, по которым не проводится ни одного занятия.**

---

## Задание 18  
**Найти студентов, посещающих все занятия своей группы.**

---

## Задание 19  
**Найти студентов, посещающих все курсы кафедры `"DM"`.**

---

## Задание 20  
**Найти студентов, состоящих во всех существующих клубах.**

---
